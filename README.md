# TgBot

Это телеграм-бот для создания и редактирования дефектных ведомостей в формате Word (.docx). Бот позволяет пользователям последовательно заполнять информацию о дефектах: местоположение, описание, фото, причину возникновения и рекомендации по устранению. Реализована интерактивная система навигации между дефектами с визуальной индикацией заполненных полей.

Подробное описание
Архитектура и технологии
Фреймворк: aiogram 3.x для асинхронной работы с Telegram Bot API

Хранение данных: MemoryStorage для FSM (Finite State Machine)

Работа с документами: python-docx для создания и редактирования Word документов

Обработка медиа: Загрузка и вставка фотографий в документ

Ключевые функциональные блоки
1. Инициализация и конфигурация
python
# Инициализация бота и диспетчера
bot = Bot(token=TOKEN)
dp = Dispatcher(storage=MemoryStorage())

# Структуры данных для управления состоянием
edit_defects = {}  # Для редактирования существующих дефектов
new_defects = {}   # Для создания новых дефектов
menu = {}          # Главное меню
2. Управление состоянием (FSM)
python
class Status(StatesGroup):
    location = State()
    description_of_defect = State()
    photo = State()
    probable_cause_of_occurrence = State()
    recommendations = State()
3. Система навигации
Inline клавиатуры: Динамически генерируются в зависимости от состояния дефекта

Визуальные индикаторы: ✅/❌ показывают заполненность полей

Сквозная нумерация: Автоматическое управление номерами дефектов

4. Работа с документами
python
# Создание и форматирование таблицы в Word
table = doc.tables[0]
cell = table.rows[number_row].cells[3]
paragraph = cell.paragraphs[0]
run = paragraph.add_run()
run.add_picture(save_path, width=Mm(84))  # Вставка изображения с заданными размерами
5. Обработка медиафайлов
Загрузка фотографий из Telegram

Автоматическое сохранение во временное хранилище

Вставка в документ с сохранением пропорций

Автоматическая очистка временных файлов

Особенности реализации
Динамические интерфейсы
python
async def status_kb_inline() -> InlineKeyboardMarkup:
    # Автоматическое переключение между режимами редактирования и создания
    if number_defect == len(table.rows)-2:
        key_name = new_defects
        key = 'nd'
    else:
        key_name = edit_defects
        key = 'qst'
Обработка состояний
python
@dp.callback_query(lambda callback: callback.data=='nd_1' or callback.data=='qst_1')
async def col_1(callback: types.CallbackQuery, state: FSMContext):
    await state.set_state(Status.location)
    await callback.answer('Введите место расположения')
Управление документами
python
# Сохранение документа
doc.save(name_document)

# Загрузка и отправка пользователю
document = FSInputFile(name_document)
await message.answer_document(document=document)
Безопасность и надежность
Обработка исключений для медиафайлов

Автоматическая очистка временных ресурсов

Валидация вводимых данных через FSM

Резервное копирование перед операциями с файлами

Возможности для улучшения (для резюме)
Интеграция с облачными хранилищами (Google Drive, Dropbox)

Добавление системы шаблонов документов

Реализация многопользовательского режима

Добавление системы экспорта в различные форматы (PDF, Excel)

Интеграция с системами учета задач (Jira, Trello)

Реализация веб-интерфейса для администрирования

Проект демонстрирует навыки работы с асинхронным программированием, обработкой медиафайлов, работой с офисными документами и созданием сложных пользовательских интерфейсов в мессенджере.
